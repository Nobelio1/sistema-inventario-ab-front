<div class="mx-48">
  <div class="mt-10">
    <h1 class="text-2xl font-bold">{{ title() }}</h1>
  </div>

  <div class="flex justify-between items-center mt-5 bg-white p-5 rounded-lg shadow-md">
    <div class="flex gap-5">
      <span>{{ usuarios().length }} Usuarios</span>
      <span class="text-green-600">{{ usuarios().filter(u = > u.estado === 'Activo').length }} Activos</span>
    </div>
    <div class="flex gap-3">
      <input
        type="text"
        placeholder="Buscar usuario..."
        [ngModel]="filtro()"
        (ngModelChange)="filtro.set($event)"
        class="px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500"
      />
      <button
        (click)="abrirModal()"
        class="bg-sky-900 text-white px-4 py-2 rounded-md cursor-pointer transition-colors hover:bg-sky-700 duration-200 flex items-center gap-2">
        <lucide-angular [img]="plusIcon" class="w-4 h-4"></lucide-angular>
        Nuevo Usuario
      </button>
    </div>
  </div>

  <div class="mt-5">
    <div class="bg-white rounded-lg shadow-md overflow-hidden">
      <table class="min-w-full">
        <thead class="bg-sky-50 border-b border-gray-200">
        <tr>
          <th class="py-3 px-6 text-left text-sm font-medium text-gray-500 uppercase">Nombre</th>
          <th class="py-3 px-6 text-left text-sm font-medium text-gray-500 uppercase">Usuario</th>
          <th class="py-3 px-6 text-left text-sm font-medium text-gray-500 uppercase">Email</th>
          <th class="py-3 px-6 text-center text-sm font-medium text-gray-500 uppercase">Rol</th>
          <th class="py-3 px-6 text-center text-sm font-medium text-gray-500 uppercase">Estado</th>
          <th class="py-3 px-6 text-center text-sm font-medium text-gray-500 uppercase">Acciones</th>
        </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          @for (usuario of usuariosFiltrados(); track usuario.id) {
            <tr class="hover:bg-gray-50 transition-colors duration-150">
              <td class="py-4 px-6 text-sm text-gray-900">
                <div class="flex items-center gap-2">
                  <lucide-angular [img]="userIcon" class="w-5 h-5 text-gray-400"></lucide-angular>
                  <span class="font-medium">{{ usuario.nombre }}</span>
                </div>
              </td>
              <td class="py-4 px-6 text-sm text-gray-900">{{ usuario.usuario }}</td>
              <td class="py-4 px-6 text-sm text-gray-900">{{ usuario.email }}</td>
              <td class="py-4 px-6 text-sm text-center">
                <span class="px-3 py-1 rounded-full text-xs font-medium"
                      [class]="getColorRol(usuario.rol)">
                  {{ usuario.rol }}
                </span>
              </td>
              <td class="py-4 px-6 text-sm text-center">
                <span class="px-3 py-1 rounded-full text-xs font-medium"
                      [class.bg-green-100]="usuario.estado === 'Activo'"
                      [class.text-green-800]="usuario.estado === 'Activo'"
                      [class.bg-gray-100]="usuario.estado === 'Inactivo'"
                      [class.text-gray-800]="usuario.estado === 'Inactivo'">
                  {{ usuario.estado }}
                </span>
              </td>
              <td class="py-4 px-6 text-sm text-center">
                <div class="flex justify-center gap-2">
                  <button
                    (click)="abrirModal(usuario)"
                    class="p-2 text-blue-600 hover:bg-blue-50 rounded transition-colors">
                    <lucide-angular [img]="editIcon" class="w-4 h-4"></lucide-angular>
                  </button>
                  <button
                    (click)="eliminarUsuario(usuario.id!)"
                    class="p-2 text-red-600 hover:bg-red-50 rounded transition-colors">
                    <lucide-angular [img]="deleteIcon" class="w-4 h-4"></lucide-angular>
                  </button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
</div>

@if (mostrarModal()) {
  <app-nuevo-usuario-modal
    [usuario]="usuarioEditar()"
    (closeModal)="cerrarModal()"
    (usuarioGuardado)="onUsuarioGuardado()">
  </app-nuevo-usuario-modal>
}
